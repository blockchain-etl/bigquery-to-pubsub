WITH times AS (SELECT DATE('2022-06-06') AS start, DATE('2022-06-07') AS end_),logs AS (SELECT block_timestamp, transaction_hash, STRUCT<block_timestamp TIMESTAMP, block_number INT, block_hash STRING, transaction_index INT, log_index INT, address STRING, data STRING, topics ARRAY<STRING>>(block_timestamp, block_number, block_hash, transaction_index, log_index, address, data, topics) AS logs FROM `bigquery-public-data.crypto_ethereum.logs`, times WHERE DATE(block_timestamp) >= start AND DATE(block_timestamp) < end_ LIMIT 100),traces AS (SELECT transaction_hash, STRUCT<from_address STRING, to_address STRING, value NUMERIC, input STRING, output STRING, trace_type STRING, call_type STRING, reward_type STRING, gas INT, gas_used INT, subtraces INT, trace_address STRING, `error` STRING, status INT, trace_id STRING>(from_address, to_address, value, input, output, trace_type, call_type, reward_type, gas, gas_used, subtraces, trace_address, `error`, status, trace_id) AS traces FROM `bigquery-public-data.crypto_ethereum.traces`, times WHERE DATE(block_timestamp) >= start AND DATE(block_timestamp) < end_) SELECT logs.block_timestamp, logs.transaction_hash, ARRAY_AGG(logs.logs) AS logs, ARRAY_AGG(traces.traces) AS traces FROM logs, traces WHERE logs.transaction_hash = traces.transaction_hash GROUP BY block_timestamp, transaction_hash


